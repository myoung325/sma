<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stop Motion Animator</title>

  <!-- Progressive Web App (PWA) manifest and theme setup -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  <link rel="icon" href="images/icon-192.png" />

  <!-- Stylesheet -->
  <link rel="stylesheet" href="animator.css" />

  <!-- JavaScript dependencies for app functionality -->
  <script src="js/assets.js" defer></script>
  <script src="js/webm.js" defer></script>
  <script src="js/animator.js" defer></script>
  <script src="js/main.js" defer></script>

  <!-- Service Worker registration for offline/PWA support -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('service-worker.js')
          .then((reg) => console.log('Service Worker registered:', reg))
          .catch((err) => console.error('Service Worker registration failed:', err));
      });
    }
  </script>
</head>
<body>
  <div id="scalable-wrapper">
    
    <!-- SVG definitions for clocks, markers, and reusable elements -->
    <svg id="svg-defs" version="1.1" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <!-- Short and long tick marks for clock face -->
        <line id="clock-short-line-def" x1="50" y1="2" x2="50" y2="10" />
        <line id="clock-long-line-def" x1="50" y1="2" x2="50" y2="18" />

        <!-- Clock face definition with hour markers -->
        <g id="clock-def">
          <g stroke="black" stroke-width="2" fill="none">
            <circle cx="50" cy="50" r="49" />
            <use xlink:href="#clock-long-line-def" />
            <use xlink:href="#clock-short-line-def" transform="rotate(30, 50, 50)" />
            <use xlink:href="#clock-short-line-def" transform="rotate(60, 50, 50)" />
            <use xlink:href="#clock-long-line-def" transform="rotate(90, 50, 50)" />
            <use xlink:href="#clock-short-line-def" transform="rotate(120, 50, 50)" />
            <use xlink:href="#clock-short-line-def" transform="rotate(150, 50, 50)" />
            <use xlink:href="#clock-long-line-def" transform="rotate(180, 50, 50)" />
            <use xlink:href="#clock-short-line-def" transform="rotate(210, 50, 50)" />
            <use xlink:href="#clock-short-line-def" transform="rotate(240, 50, 50)" />
            <use xlink:href="#clock-long-line-def" transform="rotate(270, 50, 50)" />
            <use xlink:href="#clock-short-line-def" transform="rotate(300, 50, 50)" />
            <use xlink:href="#clock-short-line-def" transform="rotate(330, 50, 50)" />
          </g>
          <!-- Red dot at clock center -->
          <circle cx="50" cy="50" r="4" stroke="none" fill="red" />
        </g>

        <!-- Clock hand definition -->
        <line id="clock-hand-def" x1="50" y1="50" x2="50" y2="2" stroke="red" stroke-width="3" />

        <!-- Timeline/progress marker definition -->
        <g id="progress-marker-def">
          <line id="progress-line" x1="0" y1="5" x2="645" y2="5"></line>
          <circle id="progress-circle" cx="640" cy="5" r="5"></circle>
        </g>
      </defs>
    </svg>

    <!-- Main layout container -->
    <div id="top-container" class="hflex">

      <!-- Left-hand column: video and controls -->
      <div id="video-column">

        <!-- Toolbar with control buttons -->
        <div id="button-wrapper">
          <div id="button-container">
            <button class="button72" id="toggleButton"><img /><div class="buttonLabel">On/Off</div></button>
            <button class="button72" id="captureButton"><img /><div class="buttonLabel">Capture</div></button>
            <button class="button72" id="undoButton"><img /><div class="buttonLabel">Undo</div></button>
            <button class="button72" id="playButton"><img /><div class="buttonLabel">Play/Stop</div></button>
            <button class="button72" id="clearButton"><img /><div class="buttonLabel">Clear</div></button>
            <button class="button72" id="clockButton" style="display: none;"><img /><div class="buttonLabel">Clock</div></button>
            <button class="button72" id="flipButton"><img /><div class="buttonLabel">Flip</div></button>
            <button class="button72" id="recordAudioButton"><img /><div class="buttonLabel">Record Audio</div></button>
            <button class="button72" id="clearAudioButton"><img /><div class="buttonLabel">Clear Audio</div></button>
            <button class="button72" id="saveButton"><img /><div class="buttonLabel">Save</div></button>
            <button class="button72" id="loadButton"><img /><div class="buttonLabel">Load</div></button>

            <!-- Camera information display -->
            <div id="camera-info">
              <div class="camera-line">Camera</div>
              <div class="camera-line">Resolution:</div>
              <div class="camera-line" id="camera-resolution">Loading...</div>
            </div>
          </div>
        </div>

        <!-- Video preview and animation canvases -->
        <div id="video-container">
          <video id="video" autoplay></video>

          <!-- Countdown overlay for timed capture -->
          <svg id="countdown" class="recede-decay" style="display: none;" width="100" height="100" viewBox="0 0 72 72" aria-hidden="true" focusable="false">
            <text x="36" y="54" fill="red" font-size="54pt" text-anchor="middle" dominant-baseline="middle"></text>
          </svg>

          <!-- Canvases: one for snapshots, one for playback -->
          <canvas id="snapshot-canvas"></canvas>
          <canvas id="play-canvas"></canvas>

          <!-- Status message display area -->
          <div id="message-container" class="vflex">
            <div id="video-message"></div>
          </div>

          <!-- Optional clock overlay -->
          <div id="clockContainer" style="display:none">
            <svg id="clock" viewBox="0 0 100 100"><use xlink:href="#clock-def" /></svg>
            <svg id="clock-hand" viewBox="0 0 100 100"><use xlink:href="#clock-hand-def" /></svg>
          </div>

          <!-- Progress/timeline indicator -->
          <div id="progress-container">
            <svg id="progress-marker"><use xlink:href="#progress-marker-def" /></svg>
          </div>
        </div>

        <!-- Playback speed control -->
        <div id="speed-container">
          <div style="flex: 99 0 auto; display:flex; flex-direction:column;">
            <input id="playbackSpeed" type="range" name="playbackSpeed" min="5" step="1" max="30" />
            <div style="display:flex; justify-content:space-between">
              <span>Slow</span><span>Fast</span>
            </div>
          </div>
          <pre class="speed-label"><span id="fps">12</span> FPS</pre>
        </div>

        <!-- Thumbnail preview strip -->
        <div id="thumbnail-container"></div>
      </div>
    </div>

    <!-- Dialogs for confirmation and saving -->
    <div id="dialog-container">
      <dialog id="clearConfirmDialog">
        <p>Are you sure you want to clear the current animation?</p>
        <button id="clearConfirmButton">OK</button>
        <button id="clearCancelButton">Cancel</button>
      </dialog>
      <dialog id="saveDialog">
        <p>Give your animation a name: <input type="text" /></p>
        <button id="saveConfirmButton">OK</button>
        <button id="saveCancelButton">Cancel</button>
      </dialog>
    </div>
  </div>
</body>
</html>
